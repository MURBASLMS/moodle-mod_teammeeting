{"version":3,"sources":["../src/lobby.js"],"names":["askToBecomePresenter","teammeetingid","ModalFactory","create","type","types","SAVE_CANCEL","title","body","key","component","then","strs","modal","setButtonText","getRoot","on","ModalEvents","save","e","preventDefault","button","getFooter","find","getActionSelector","attr","asyncSet","Templates","render","html","bind","nominateOneselfAndGo","show","Ajax","call","methodname","args","data","window","location","href","externalurl","catch","Notification","exception","setupReadyCheck","readyCheck","isready","setTimeout","init","canpresent"],"mappings":"qPAuBA,OACA,OACA,OACA,OAEA,O,sDAIMA,CAAAA,CAAoB,CAAG,SAACC,CAAD,CAAmB,CAC9CC,UAAaC,MAAb,CAAoB,CAClBC,IAAI,CAAEF,UAAaG,KAAb,CAAmBC,WADP,CAElBC,KAAK,CAAE,iBAAW,iBAAX,CAA8B,iBAA9B,CAFW,CAGlBC,IAAI,CAAE,kBAAY,CAChB,CAAEC,GAAG,CAAE,sCAAP,CAA+CC,SAAS,CAAE,iBAA1D,CADgB,CAEhB,CAAED,GAAG,CAAE,sBAAP,CAA+BC,SAAS,CAAE,iBAA1C,CAFgB,CAAZ,EAGHC,IAHG,CAGE,SAACC,CAAD,CAAU,CAChB,mBAAaA,CAAI,CAAC,CAAD,CAAjB,mBAA8BA,CAAI,CAAC,CAAD,CAAlC,QACD,CALK,CAHY,CAApB,EASGD,IATH,CASQ,SAACE,CAAD,CAAW,CACjBA,CAAK,CAACC,aAAN,CAAoB,QAApB,CAA8B,iBAAW,aAAX,CAA0B,iBAA1B,CAA9B,EACAD,CAAK,CAACC,aAAN,CAAoB,MAApB,CAA4B,iBAAW,gBAAX,CAA6B,iBAA7B,CAA5B,EACAD,CAAK,CAACE,OAAN,GAAgBC,EAAhB,CAAmBC,UAAYC,IAA/B,CAAqC,SAACC,CAAD,CAAO,CAC1CA,CAAC,CAACC,cAAF,GAGA,GAAMC,CAAAA,CAAM,CAAGR,CAAK,CAACS,SAAN,GAAkBC,IAAlB,CAAuBV,CAAK,CAACW,iBAAN,CAAwB,MAAxB,CAAvB,CAAf,CACAH,CAAM,CAACI,IAAP,CAAY,UAAZ,KACAZ,CAAK,CAACa,QAAN,CAAeC,UAAUC,MAAV,CAAiB,cAAjB,CAAiC,EAAjC,CAAf,CAAqDP,CAAM,CAACQ,IAAP,CAAYC,IAAZ,CAAiBT,CAAjB,CAArD,EAEAU,CAAoB,CAAC9B,CAAD,CACrB,CATD,EAUAY,CAAK,CAACmB,IAAN,EACD,CAvBD,CAwBD,C,CAEKD,CAAoB,CAAG,SAAC9B,CAAD,CAAmB,CAC9CgC,UAAKC,IAAL,CAAU,CACR,CACEC,UAAU,CAAE,oCADd,CAEEC,IAAI,CAAE,CAAEnC,aAAa,CAAbA,CAAF,CAFR,CADQ,CAAV,EAKG,CALH,EAMGU,IANH,CAMQ,SAAC0B,CAAD,CAAU,CACdC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAuBH,CAAI,CAACI,WAC7B,CARH,EASGC,KATH,CASSC,UAAaC,SATtB,CAUD,C,CAEKC,CAAe,CAAG,SAAC5C,CAAD,CAAmB,CACzC,GAAM6C,CAAAA,CAAU,CAAG,UAAM,CACvBb,UAAKC,IAAL,CAAU,CACR,CACEC,UAAU,CAAE,kCADd,CAEEC,IAAI,CAAE,CAAEnC,aAAa,CAAEA,CAAjB,CAFR,CADQ,CAAV,EAKG,CALH,EAMGU,IANH,CAMQ,SAAU0B,CAAV,CAAgB,CACpB,GAAIA,CAAI,CAACU,OAAT,CAAkB,CAChBT,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAuBH,CAAI,CAACI,WAA5B,CACA,MACD,CACDO,UAAU,CAACF,CAAD,OACX,CAZH,EAaGJ,KAbH,CAaSC,UAAaC,SAbtB,CAcD,CAfD,CAgBAI,UAAU,CAACF,CAAD,OACX,C,QAEmB,QAAPG,CAAAA,IAAO,CAAChD,CAAD,CAAgBiD,CAAhB,CAA+B,CACjD,GAAIA,CAAJ,CAAgB,CACdlD,CAAoB,CAACC,CAAD,CACrB,CACD4C,CAAe,CAAC5C,CAAD,CAChB,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Lobby.\n *\n * @module     mod_teammeeting/lobby\n * @copyright  2022 Murdoch University\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport { get_string, get_strings } from 'core/str';\nimport Templates from 'core/templates';\n\nconst READY_CHECK_INTERVAL = 15 * 1000;\n\nconst askToBecomePresenter = (teammeetingid) => {\n  ModalFactory.create({\n    type: ModalFactory.types.SAVE_CANCEL,\n    title: get_string('sessionnotready', 'mod_teammeeting'),\n    body: get_strings([\n      { key: 'sessionrequiresorganiserinstructions', component: 'mod_teammeeting' },\n      { key: 'whatwouldyouliketodo', component: 'mod_teammeeting' },\n    ]).then((strs) => {\n      return `<p>${strs[0]}</p><p>${strs[1]}</p>`;\n    }),\n  }).then((modal) => {\n    modal.setButtonText('cancel', get_string('waitinstead', 'mod_teammeeting'));\n    modal.setButtonText('save', get_string('nominatemyself', 'mod_teammeeting'));\n    modal.getRoot().on(ModalEvents.save, (e) => {\n      e.preventDefault();\n\n      // Disable the button and show spinner.\n      const button = modal.getFooter().find(modal.getActionSelector('save'));\n      button.attr('disabled', true);\n      modal.asyncSet(Templates.render('core/loading', {}), button.html.bind(button));\n\n      nominateOneselfAndGo(teammeetingid);\n    });\n    modal.show();\n  });\n};\n\nconst nominateOneselfAndGo = (teammeetingid) => {\n  Ajax.call([\n    {\n      methodname: 'mod_teammeeting_nominate_organiser',\n      args: { teammeetingid },\n    },\n  ])[0]\n    .then((data) => {\n      window.location.href = data.externalurl;\n    })\n    .catch(Notification.exception);\n};\n\nconst setupReadyCheck = (teammeetingid) => {\n  const readyCheck = () => {\n    Ajax.call([\n      {\n        methodname: 'mod_teammeeting_is_meeting_ready',\n        args: { teammeetingid: teammeetingid },\n      },\n    ])[0]\n      .then(function (data) {\n        if (data.isready) {\n          window.location.href = data.externalurl;\n          return;\n        }\n        setTimeout(readyCheck, READY_CHECK_INTERVAL);\n      })\n      .catch(Notification.exception);\n  };\n  setTimeout(readyCheck, READY_CHECK_INTERVAL);\n};\n\nexport const init = (teammeetingid, canpresent) => {\n  if (canpresent) {\n    askToBecomePresenter(teammeetingid);\n  }\n  setupReadyCheck(teammeetingid);\n};\n"],"file":"lobby.min.js"}